!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).QX=t()}(this,(function(){"use strict";const e=(()=>{var e=e||{};!function(){void 0===e.escapeMode&&(e.escapeMode=!0);e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0);e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0);void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0);e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1);e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1)}();var t=1,s=3,o=4,n=8,r=9;function a(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function i(e,t,s,o){for(var n=0;n<e.length;n++){var r=e[n];if("string"==typeof r){if(r==o)break}else if(r instanceof RegExp){if(r.test(o))break}else if("function"==typeof r&&r(t,s,o))break}return n!=e.length}function l(t,s,o){if("property"===e.arrayAccessForm)t[s]instanceof Array?t[s+"_asArray"]=t[s]:t[s+"_asArray"]=[t[s]];!(t[s]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,s,o)&&(t[s]=[t[s]])}function d(t,s,o){if(e.datetimeAccessFormPaths.length>0){var n=o.split(".#")[0];return i(e.datetimeAccessFormPaths,t,s,n)?function(e){var t=e.split(/[-T:+Z]/g),s=new Date(t[0],t[1]-1,t[2]),o=t[5].split(".");if(s.setHours(t[3],t[4],o[0]),o.length>1&&s.setMilliseconds(o[1]),t[6]&&t[7]){var n=60*t[6]+Number(t[7]);n=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*n:n),s.setMinutes(s.getMinutes()-n-s.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(s=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds())));return s}(t):t}return t}function p(s,o,n,r){return!(o==t&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,s,n,r)}function u(i,c){if(i.nodeType==r){for(var _=new Object,m=i.childNodes,P=0;P<m.length;P++){if((y=m.item(P)).nodeType==t)_[g=a(y)]=u(y,g)}return _}if(i.nodeType==t){(_=new Object).__cnt=0;for(m=i.childNodes,P=0;P<m.length;P++){var y,g=a(y=m.item(P));if(y.nodeType!=n){var T=c+"."+g;p(_,y.nodeType,g,T)&&(_.__cnt++,null==_[g]?(_[g]=u(y,T),l(_,g,T)):(null!=_[g]&&(_[g]instanceof Array||(_[g]=[_[g]],l(_,g,T))),_[g][_[g].length]=u(y,T)))}}for(var f=0;f<i.attributes.length;f++){var S=i.attributes.item(f);_.__cnt++,_[e.attributePrefix+S.name]=S.value}var x=function(e){return e.prefix}(i);return null!=x&&""!=x&&(_.__cnt++,_.__prefix=x),null!=_["#text"]&&(_.__text=_["#text"],_.__text instanceof Array&&(_.__text=_.__text.join("\n")),e.stripWhitespaces&&(_.__text=_.__text.trim()),delete _["#text"],"property"==e.arrayAccessForm&&delete _["#text_asArray"],_.__text=d(_.__text,g,c+"."+g)),null!=_["#cdata-section"]&&(_.__cdata=_["#cdata-section"],delete _["#cdata-section"],"property"==e.arrayAccessForm&&delete _["#cdata-section_asArray"]),0==_.__cnt&&"text"==e.emptyNodeForm?_="":1==_.__cnt&&null!=_.__text?_=_.__text:1!=_.__cnt||null==_.__cdata||e.keepCData?_.__cnt>1&&null!=_.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==_.__text||""==_.__text.trim())&&delete _.__text:_=_.__cdata,delete _.__cnt,!e.enableToStringFunc||null==_.__text&&null==_.__cdata||(_.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),_}if(i.nodeType==s||i.nodeType==o)return i.nodeValue}const c=function(e){return u(e)};return{xml_str2json:function(e){var t=function(e){var t,s=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;if(window.DOMParser){var o=new window.DOMParser,n=null;if(!s)try{n=o.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){n=null}try{t=o.parseFromString(e,"text/xml"),null!=n&&t.getElementsByTagNameNS(n,"parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t}(e);return null!=t?c(t):null}}})().xml_str2json,t=(e,t,s)=>new Promise(((o,n)=>{const r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?o(JSON.parse(r.responseText)):n(r.status))},"get"!==e&&"GET"!==e||("object"==typeof s&&(s=Object.keys(s).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(s[e])})).join("&")),t=s?t+"?"+s:t,r.open(e,t,!0),r.send()),"post"!==e&&"POST"!==e||(r.open(e,t,!0),r.setRequestHeader("Accept","*/*"),r.send(JSON.stringify(s)))})),s=(e,t,s)=>new Promise(((o,n)=>{const r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?o(r.responseText):n(r.status))},"post"!==e&&"POST"!==e||(r.open(e,t,!0),r.setRequestHeader("Accept","*/*"),r.send(JSON.stringify(s)))})),o="http://127.0.0.1:9585/icvs2/",n={subscriptionGps:e=>{let t=e.token,n=e.epid||"",r=e.puid||"",a=e.idx||0;return s("POST",o+"RawRequest?dstType=33&token="+t,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" EPID="'+n+'"><Res Type="ST" Idx="'+a+'" OptID="C_GS_SubscribeGPSData"><Param></Param></Res></C><OSets><Res OType="201" OID="'+r+'" Type="GPS" Idx="'+a+'"></Res></OSets></M>'})},getPuidLastGps:e=>{let t=e.token,n=e.puid||[],r=e.epid||"",a="<OSets>";return a+='<Res OType="201" OID="'+n+'" Type="GPS" Idx="0"></Res>',a+="</OSets>",s("POST",o+'RawRequest?dstType=33&dstID=""&token='+t,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" EPID="'+r+'"><Res Type="ST" Idx="0" OptID="C_GS_QueryLastGPSData"><Param></Param></Res></C>'+a+"</M>"})},getPuidHistoryGps:e=>{let t=e.token,n=e.offset||0,r=e.count||100,a=e.begin,i=e.end,l=e.puid,d=e.epid||"",p="<OSets>";return p+='<Res OType="201" OID="'+l+'" Type="ST" Idx="0"></Res>',p+="</OSets>",s("POST",o+'RawRequest?dstType=33&dstID=""&token='+t,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" EPID="'+d+'"><Res Type="ST" Idx="0" OptID="C_GS_QueryHistoryGPSData"><Param  Offset="'+n+'" Count="'+r+'" Begin="'+a+'" End="'+i+'"></Param></Res></C>'+p+"</M>"})}},r="http://127.0.0.1:9585/icvs2/",a={async getPresetPosList(t){let s={code:-1,rows:[]},o=t.idx||"0",n=t.puid||"",a=t.token||"",i=`${r}RawRequest?dstType=201&dstID=${n}&token=${a}`,l={xml:`<?xml version="1.0" encoding="UTF-8"?>\n    <M Type="ComReq">\n      <C Type="G" Prio="1" EPID="system" Lang="zh_CN">\n        <Res Type="PTZ" Idx="${o}" OptID="F_PTZ_PresetPositionSets" Stream="0"><Param></Param></Res>\n      </C>\n    </M>`},d=await((t,s,o)=>new Promise(((n,r)=>{const a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){let t=e(a.responseText);n(t)}else r(a.status)},"post"!==t&&"POST"!==t||(a.open(t,s,!0),a.setRequestHeader("Accept","*/*"),a.send(JSON.stringify(o)))})))("post",i,l);try{s.rows=d.M.C.Res.Param.Preset,s.code=d.M.C._SPError}catch(e){s.msg="fail"}return s},setPresetPos:e=>t("post",`${r}PTZ/C_PTZ_SetPresetPos`,e),moveToPresetPos:e=>t("post",`${r}PTZ/C_PTZ_MoveToPresetPos`,e),gotoOriginalPresetPos:e=>t("post",`${r}PTZ/C_PTZ_GotoOriginalPresetPos`,e)},i="http://127.0.0.1:9585/icvs2/",l={ptzControl:e=>{let s=e.puid||"",o=e.idx||0,n=e.control||"",r=e.speed||"",a="",l=e.token;if(s&&n){if("left"===n||"up"===n||"right"===n||"down"===n||"stop"===n){return t("post",`${i}PTZ/C_PTZ_Turn`,{puid:s,motion:n,idx:o,token:l,speed:r})}if("zoomin"===n){return t("post",`${i}PTZ/C_PTZ_ZoomInPicture`,{speed:r,puid:s,idx:o,token:l})}if("zoomout"===n){return t("post",`${i}PTZ/C_PTZ_ZoomOutPicture`,{speed:r,puid:s,idx:o,token:l})}if("stopzoom"===n){return t("post",`${i}PTZ/C_PTZ_StopPictureZoom`,{speed:r,puid:s,idx:o,token:l})}if("focusfar"===n){return t("post",`${i}PTZ/C_PTZ_MakeFocusFar`,{speed:r,puid:s,idx:o,token:l})}if("focusnear"===n){return t("post",`${i}PTZ/C_PTZ_MakeFocusNear`,{speed:r,puid:s,idx:o,token:l})}if("stopfocus"===n){return t("post",`${i}PTZ/C_PTZ_StopFocusMove`,{speed:r,puid:s,idx:o,token:l})}if("augment"===n){return a='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"> <Res Type="IV" Idx="'+o+'" OptID="C_PTZ_AugmentAperture" Stream="0"><Param></Param></Res></C></M>',QxRequestXML("post",`${i}RawRequest?dstType=201&dstID=${s}&token=${l}`,{xml:a})}if("minish"===n){return a='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"><Res Type="IV" Idx="'+o+'" OptID="C_PTZ_MinishAperture" Stream="0"><Param></Param></Res></C></M>',QxRequestXML("post",`${i}RawRequest?dstType=201&dstID=${s}&token=${l}`,{xml:a})}if("stopaperture"===n){return a='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"><Res Type="IV" Idx="'+o+'" OptID="C_PTZ_StopApertureZoom" Stream="0"><Param></Param></Res></C></M>',QxRequestXML("post",`${i}RawRequest?dstType=201&dstID=${s}&token=${l}`,{xml:a})}}}},d="http://127.0.0.1:9585/icvs2/",p={startCloudSnapshot:e=>t("post",`${d}CSS/C_CSS_StartManualSnapshot`,e),startCloudStorage:e=>t("post",`${d}CSS/C_CSS_StartManualStorage`,e),stopCloudStorage:e=>t("post",`${d}CSS/C_CSS_StopManualStorage`,e),getCloudFile:e=>t("get",`${d}CSS/C_CSS_QueryStorageFiles`,e)},u="http://127.0.0.1:9585/icvs2/",c={startSGSnapshot:e=>t("get",`${u}SG/C_SG_StartSnapshot`,e),startSGStorage:e=>(e.IVIdx=e.idx||"0",t("get",`${u}SG/VODFile.flv`,e)),getDeviceFile:e=>t("get",`${u}SG/C_SG_QueryRecordFiles`,e)},_="http://127.0.0.1:9585/icvs2/",m={startLocalSnap:e=>{let s={playID:e.playID,localPath:e.localPath,count:e.count||1,interval:e.interval||6,token:e.token};return t("get",`${_}localSnapshot`,s)},stopLocalSnapShot:e=>t("get",`${_}cancelLocalSnapshot`,e),startLocalVideo:e=>{let s={playID:e.playID,localPath:e.localPath,maxFileTime:e.maxFileTime||300,token:e.token};return t("get",`${_}localRecord`,s)},stopLocalVideo:e=>t("get",`${_}CancelLocalRecord`,e)},P="http://127.0.0.1:9585/icvs2/",y={downloadCloudFile:e=>t("get",`${P}downloadCloudFile2`,e),downloadDeviceFile:e=>t("get",`${P}downloadDeviceFile2`,e),setPuaseDownload:e=>t("get",`${P}puaseDownload2`,e),setRestoreDownload:e=>t("get",`${P}restoreDownload2`,e),setStopDownload:e=>t("get",`${P}stopDownload2`,e)},g="http://127.0.0.1:9585/icvs2/",T={getVodDeviceFile:e=>t("get",`${g}vodDeviceFile2`,e),getVodCloudFile:e=>t("get",`${g}vodCloudFile2`,e),setPuaseVod:e=>t("get",`${g}puaseVod2`,e),setRestoreVod:e=>t("get",`${g}restoreVod2`,e),setSpeedVod:e=>t("get",`${g}setVodSpeed2`,e),setOffsetVod:e=>t("get",`${g}setVodOffset2`,e)},f="http://127.0.0.1:9585/icvs2/",S={login:e=>t("post",`${f}login`,e),getDeviceList:e=>t("get",`${f}CAS/C_CAS_QueryPUIDSets`,e),getDeviceByPuid:e=>t("get",`${f}C_CAS_QueryPUIDRes`,e),getPlayVideoId:e=>t("get",`${f}video/startVideo2`,e),startTalk:e=>t("get",`${f}audio/startTalk2`,e),startCall:e=>t("get",`${f}audio/startCall2`,e),stoptStream:e=>t("get",`${f}stopPlay2`,e),enablePlayAudio:e=>t("get",`${f}enablePlayAudio`,e)};return Object.assign(S,n,a,l,p,c,m,y,T),S}));
