!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).QX=t()}(this,(function(){"use strict";const e=(e,t,o)=>new Promise(((s,n)=>{const r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?s(JSON.parse(r.responseText)):n(r.status))},"get"!==e&&"GET"!==e||("object"==typeof o&&(o=Object.keys(o).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])})).join("&")),t=o?t+"?"+o:t,r.open(e,t,!0),r.send()),"post"!==e&&"POST"!==e||(r.open(e,t,!0),r.setRequestHeader("Accept","*/*"),r.send(JSON.stringify(o)))})),t=(e,t,s)=>new Promise(((n,r)=>{const a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){let e=o(a.responseText);n(e)}else r(a.status)},"post"!==e&&"POST"!==e||(a.open(e,t,!0),a.setRequestHeader("Accept","*/*"),a.send(JSON.stringify(s)))})),o=e=>{if(!e)return{};var t=function(e){return String(e||"").replace(/-/g,"_")},o=function(e){return $.isArray(e)||(e=[e]),e.length=e.length,e};if("string"==typeof e&&(e=$.text2xml(e)),e.nodeType){if(3==e.nodeType||4==e.nodeType)return e.nodeValue;var s=9==e.nodeType?e.documentElement:e,n=function e(s,n){if(!s)return null;var r="",a=null,i=null;return s.nodeType,t(s.localName||s.nodeName),s.text||s.nodeValue,s.childNodes&&s.childNodes.length>0&&$.each(s.childNodes,(function(s,n){var i=n.nodeType,d=t(n.localName||n.nodeName),p=n.text||n.nodeValue||"";if(8!=i)if(3!=i&&4!=i&&d)(a=a||{})[d]?(a[d].length||(a[d]=o(a[d])),a[d]=o(a[d]),a[d][a[d].length]=e(n),a[d].length=a[d].length):a[d]=e(n);else{if(p.match(/^\s+$/))return;r+=p.replace(/^\s+/,"").replace(/\s+$/,"")}})),s.attributes&&s.attributes.length>0&&(i={},a=a||{},$.each(s.attributes,(function(e,s){var n=t(s.name),r=s.value;i[n]=r,a[n]?(a[cnn]=o(a[cnn]),a[n][a[n].length]=r,a[n].length=a[n].length):a[n]=r}))),a&&(a=$.extend(""!=r?new String(r):{},a||{}),(r=a.text?[a.text||""].concat([r]):r)&&(a.text=r),r=""),a||r}(s);return e=null,s=null,n}},s="http://127.0.0.1:9585/icvs2/";return{login:t=>e("post",`${s}login`,t),getDeviceList:t=>e("get",`${s}CAS/C_CAS_QueryPUIDSets`,t),getDeviceByPuid:t=>e("get",`${s}C_CAS_QueryPUIDRes`,t),getPlayVideoId:t=>e("get",`${s}video/startVideo2`,t),ptzControl:o=>{let n=o.puid||"",r=o.idx||0,a=o.control||"",i=o.speed||"",d="",p=o.token;if(n&&a){if("left"===a||"up"===a||"right"===a||"down"===a||"stop"===a){return e("post",`${s}PTZ/C_PTZ_Turn`,{puid:n,motion:a,idx:r,speed:i,token:p})}if("zoomin"===a){return e("post",`${s}PTZ/C_PTZ_ZoomInPicture`,{speed:i,puid:n,idx:r,token:p})}if("zoomout"===a){return e("post",`${s}PTZ/C_PTZ_ZoomOutPicture`,{speed:i,puid:n,idx:r,token:p})}if("stopzoom"===a){return e("post",`${s}PTZ/C_PTZ_StopPictureZoom`,{speed:i,puid:n,idx:r,token:p})}if("focusfar"===a){return e("post",`${s}PTZ/C_PTZ_MakeFocusFar`,{speed:i,puid:n,idx:r,token:p})}if("focusnear"===a){return e("post",`${s}PTZ/C_PTZ_MakeFocusNear`,{speed:i,puid:n,idx:r,token:p})}if("stopfocus"===a){return e("post",`${s}PTZ/C_PTZ_StopFocusMove`,{speed:i,puid:n,idx:r,token:p})}if("augment"===a){return d='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"> <Res Type="IV" Idx="'+r+'" OptID="C_PTZ_AugmentAperture" Stream="0"><Param></Param></Res></C></M>',t("post",`${s}RawRequest?dstType=201&dstID='${n}'&token=${p}`,{xml:d})}if("minish"===a){return d='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"><Res Type="IV" Idx="'+r+'" OptID="C_PTZ_MinishAperture" Stream="0"><Param></Param></Res></C></M>',t("post",`${s}RawRequest?dstType=201&dstID='${n}'&token=${p}`,{xml:d})}if("stopaperture"===a){return d='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"><Res Type="IV" Idx="'+r+'" OptID="C_PTZ_StopApertureZoom" Stream="0"><Param></Param></Res></C></M>',t("post",`${s}RawRequest?dstType=201&dstID='${n}'&token=${p}`,{xml:d})}}},getPresetPosList(e){let o=e.puid||"",n=e.token||"";return t("post",`${s}RawRequest?dstType=201&dstID='${o}'&token=${n}`,{xml:'<?xml version="1.0" encoding="UTF-8"?>\n    <M Type="ComReq">\n      <C Type="G" Prio="1" EPID="system" Lang="zh_CN">\n        <Res Type="PTZ" Idx="0" OptID="F_PTZ_PresetPositionSets" Stream="0"><Param></Param></Res>\n      </C>\n    </M>'})},setPresetPos:t=>e("post",`${s}PTZ/C_PTZ_SetPresetPos`,t),moveToPresetPos:t=>e("post",`${s}PTZ/C_PTZ_MoveToPresetPos`,t),gotoOriginalPresetPos:t=>e("post",`${s}PTZ/C_PTZ_GotoOriginalPresetPos`,t),startCloudSnapshot:t=>e("post",`${s}CSS/C_CSS_StartManualSnapshot`,t),startCloudStorage:t=>e("post",`${s}CSS/C_CSS_StartManualStorage`,t),stopCloudStorage:t=>e("post",`${s}CSS/C_CSS_StopManualStorage`,t),startSGSnapshot:t=>e("get",`${s}SG/C_SG_StartSnapshot`,t),startSGStorage:t=>e("get",`${s}SG/VODFile.flv`,t),startTalk:t=>e("get",`${s}audio/startTalk2`,t),startCall:t=>e("get",`${s}audio/startCall2`,t),stoptStream:t=>e("get",`${s}stopPlay2`,t),enablePlayAudio:t=>e("get",`${s}enablePlayAudio`,t),getCloudFile:t=>e("get",`${s}CSS/C_CSS_QueryStorageFiles`,t),getDeviceFile:t=>e("get",`${s}SG/C_SG_QueryRecordFiles`,t),downloadCloudFile:t=>e("get",`${s}downloadCloudFile2`,t),downloadDeviceFile:t=>e("get",`${s}downloadDeviceFile2`,t),setPuaseDownload:t=>e("get",`${s}puaseDownload2`,t),setRestoreDownload:t=>e("get",`${s}restoreDownload2`,t),setStopDownload:t=>e("get",`${s}stopDownload2`,t),getVodCloudFile:t=>e("get",`${s}vodCloudFile2`,t),getVodDeviceFile:t=>e("get",`${s}vodDeviceFile2`,t),setPuaseVod:t=>e("get",`${s}puaseVod2`,t),setRestoreVod:t=>e("get",`${s}restoreVod2`,t),setSpeedVod:t=>e("get",`${s}setVodSpeed2`,t),setOffsetVod:t=>e("get",`${s}setVodOffset2`,t),subscriptionGps:e=>{let o=e.token,n=e.epid||"",r=e.puid||"",a=e.idx||0;return t("POST",s+"RawRequest?dstType=33&token="+o,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" Prio="1" EPID="'+n+'"><Res Type="ST" Idx="'+a+'" OptID="C_GS_SubscribeGPSData"><Param></Param></Res></C><OSets><Res OType="201" OID="'+r+'" Type="GPS" Idx="'+a+'"></Res></OSets></M>'})},getPuidLastGps:e=>{let o=e.token,n=e.puid||[],r=e.epid||"",a="<OSets>";return a+='<Res OType="201" OID="'+n+'" Type="GPS" Idx="0"></Res>',a+="</OSets>",t("POST",s+'RawRequest?dstType=33&dstID=""&token='+o,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" Prio="1" EPID="'+r+'"><Res Type="ST" Idx="0" OptID="C_GS_QueryLastGPSData"><Param></Param></Res></C>'+a+"</M>"})},getPuidHistoryGps:e=>{let o=e.token,n=e.offset||0,r=e.count||100,a=e.begin,i=e.end,d=e.puid,p=e.epid||"",u="<OSets>";return u+='<Res OType="201" OID="'+d+'" Type="ST" Idx="0"></Res>',u+="</OSets>",t("POST",s+'RawRequest?dstType=33&dstID=""&token='+o,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" Prio="1" EPID="'+p+'"><Res Type="ST" Idx="0" OptID="C_GS_QueryHistoryGPSData"><Param  Offset="'+n+'" Count="'+r+'" Begin="'+a+'" End="'+i+'"></Param></Res></C>'+u+"</M>"})}}}));
