!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).QX=t()}(this,(function(){"use strict";const e=(()=>{var e=e||{};!function(){void 0===e.escapeMode&&(e.escapeMode=!0);e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0);e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0);void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0);e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1);e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1)}();var t=1,o=3,s=4,r=8,n=9;function a(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function i(e,t,o,s){for(var r=0;r<e.length;r++){var n=e[r];if("string"==typeof n){if(n==s)break}else if(n instanceof RegExp){if(n.test(s))break}else if("function"==typeof n&&n(t,o,s))break}return r!=e.length}function d(t,o,s){if("property"===e.arrayAccessForm)t[o]instanceof Array?t[o+"_asArray"]=t[o]:t[o+"_asArray"]=[t[o]];!(t[o]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,o,s)&&(t[o]=[t[o]])}function l(t,o,s){if(e.datetimeAccessFormPaths.length>0){var r=s.split(".#")[0];return i(e.datetimeAccessFormPaths,t,o,r)?function(e){var t=e.split(/[-T:+Z]/g),o=new Date(t[0],t[1]-1,t[2]),s=t[5].split(".");if(o.setHours(t[3],t[4],s[0]),s.length>1&&o.setMilliseconds(s[1]),t[6]&&t[7]){var r=60*t[6]+Number(t[7]);r=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*r:r),o.setMinutes(o.getMinutes()-r-o.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(o=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds())));return o}(t):t}return t}function p(o,s,r,n){return!(s==t&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,o,r,n)}function u(i,c){if(i.nodeType==n){for(var _=new Object,m=i.childNodes,P=0;P<m.length;P++){if((g=m.item(P)).nodeType==t)_[y=a(g)]=u(g,y)}return _}if(i.nodeType==t){(_=new Object).__cnt=0;for(m=i.childNodes,P=0;P<m.length;P++){var g,y=a(g=m.item(P));if(g.nodeType!=r){var S=c+"."+y;p(_,g.nodeType,y,S)&&(_.__cnt++,null==_[y]?(_[y]=u(g,S),d(_,y,S)):(null!=_[y]&&(_[y]instanceof Array||(_[y]=[_[y]],d(_,y,S))),_[y][_[y].length]=u(g,S)))}}for(var T=0;T<i.attributes.length;T++){var f=i.attributes.item(T);_.__cnt++,_[e.attributePrefix+f.name]=f.value}var x=function(e){return e.prefix}(i);return null!=x&&""!=x&&(_.__cnt++,_.__prefix=x),null!=_["#text"]&&(_.__text=_["#text"],_.__text instanceof Array&&(_.__text=_.__text.join("\n")),e.stripWhitespaces&&(_.__text=_.__text.trim()),delete _["#text"],"property"==e.arrayAccessForm&&delete _["#text_asArray"],_.__text=l(_.__text,y,c+"."+y)),null!=_["#cdata-section"]&&(_.__cdata=_["#cdata-section"],delete _["#cdata-section"],"property"==e.arrayAccessForm&&delete _["#cdata-section_asArray"]),0==_.__cnt&&"text"==e.emptyNodeForm?_="":1==_.__cnt&&null!=_.__text?_=_.__text:1!=_.__cnt||null==_.__cdata||e.keepCData?_.__cnt>1&&null!=_.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==_.__text||""==_.__text.trim())&&delete _.__text:_=_.__cdata,delete _.__cnt,!e.enableToStringFunc||null==_.__text&&null==_.__cdata||(_.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),_}if(i.nodeType==o||i.nodeType==s)return i.nodeValue}const c=function(e){return u(e)};return{xml_str2json:function(e){var t=function(e){var t,o=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;if(window.DOMParser){var s=new window.DOMParser,r=null;if(!o)try{r=s.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){r=null}try{t=s.parseFromString(e,"text/xml"),null!=r&&t.getElementsByTagNameNS(r,"parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t}(e);return null!=t?c(t):null}}})().xml_str2json,t=(e,t,o)=>new Promise(((s,r)=>{const n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?s(JSON.parse(n.responseText)):r(n.status))},"get"!==e&&"GET"!==e||("object"==typeof o&&(o=Object.keys(o).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])})).join("&")),t=o?t+"?"+o:t,n.open(e,t,!0),n.send()),"post"!==e&&"POST"!==e||(n.open(e,t,!0),n.setRequestHeader("Accept","*/*"),n.send(JSON.stringify(o)))})),o=(t,o,s)=>new Promise(((r,n)=>{const a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){let t=e(a.responseText);r(t)}else n(a.status)},"post"!==t&&"POST"!==t||(a.open(t,o,!0),a.setRequestHeader("Accept","*/*"),a.send(JSON.stringify(s)))})),s=(e,t,o)=>new Promise(((s,r)=>{const n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?s(n.responseText):r(n.status))},"post"!==e&&"POST"!==e||(n.open(e,t,!0),n.setRequestHeader("Accept","*/*"),n.send(JSON.stringify(o)))})),r="http://127.0.0.1:9585/icvs2/";return{login:e=>t("post",`${r}login`,e),getDeviceList:e=>t("get",`${r}CAS/C_CAS_QueryPUIDSets`,e),getDeviceByPuid:e=>t("get",`${r}C_CAS_QueryPUIDRes`,e),getPlayVideoId:e=>t("get",`${r}video/startVideo2`,e),ptzControl:e=>{let s=e.puid||"",n=e.idx||0,a=e.control||"",i=e.speed||"",d="",l=e.token;if(s&&a){if("left"===a||"up"===a||"right"===a||"down"===a||"stop"===a){return t("post",`${r}PTZ/C_PTZ_Turn`,{puid:s,motion:a,idx:n,token:l,speed:i})}if("zoomin"===a){return t("post",`${r}PTZ/C_PTZ_ZoomInPicture`,{speed:i,puid:s,idx:n,token:l})}if("zoomout"===a){return t("post",`${r}PTZ/C_PTZ_ZoomOutPicture`,{speed:i,puid:s,idx:n,token:l})}if("stopzoom"===a){return t("post",`${r}PTZ/C_PTZ_StopPictureZoom`,{speed:i,puid:s,idx:n,token:l})}if("focusfar"===a){return t("post",`${r}PTZ/C_PTZ_MakeFocusFar`,{speed:i,puid:s,idx:n,token:l})}if("focusnear"===a){return t("post",`${r}PTZ/C_PTZ_MakeFocusNear`,{speed:i,puid:s,idx:n,token:l})}if("stopfocus"===a){return t("post",`${r}PTZ/C_PTZ_StopFocusMove`,{speed:i,puid:s,idx:n,token:l})}if("augment"===a){return d='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"> <Res Type="IV" Idx="'+n+'" OptID="C_PTZ_AugmentAperture" Stream="0"><Param></Param></Res></C></M>',o("post",`${r}RawRequest?dstType=201&dstID=${s}&token=${l}`,{xml:d})}if("minish"===a){return d='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"><Res Type="IV" Idx="'+n+'" OptID="C_PTZ_MinishAperture" Stream="0"><Param></Param></Res></C></M>',o("post",`${r}RawRequest?dstType=201&dstID=${s}&token=${l}`,{xml:d})}if("stopaperture"===a){return d='<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="G" Prio="1" EPID="system" Lang="zh_CN"><Res Type="IV" Idx="'+n+'" OptID="C_PTZ_StopApertureZoom" Stream="0"><Param></Param></Res></C></M>',o("post",`${r}RawRequest?dstType=201&dstID=${s}&token=${l}`,{xml:d})}}},async getPresetPosList(e){let t={code:-1,rows:[]},s=e.idx||"0",n=e.puid||"",a=e.token||"",i=`${r}RawRequest?dstType=201&dstID=${n}&token=${a}`,d={xml:`<?xml version="1.0" encoding="UTF-8"?>\n    <M Type="ComReq">\n      <C Type="G" Prio="1" EPID="system" Lang="zh_CN">\n        <Res Type="PTZ" Idx="${s}" OptID="F_PTZ_PresetPositionSets" Stream="0"><Param></Param></Res>\n      </C>\n    </M>`},l=await o("post",i,d);try{t.rows=l.M.C.Res.Param.Preset,t.code=l.M.C._SPError}catch(e){t.msg="fail"}return t},setPresetPos:e=>t("post",`${r}PTZ/C_PTZ_SetPresetPos`,e),moveToPresetPos:e=>t("post",`${r}PTZ/C_PTZ_MoveToPresetPos`,e),gotoOriginalPresetPos:e=>t("post",`${r}PTZ/C_PTZ_GotoOriginalPresetPos`,e),startCloudSnapshot:e=>t("post",`${r}CSS/C_CSS_StartManualSnapshot`,e),startCloudStorage:e=>t("post",`${r}CSS/C_CSS_StartManualStorage`,e),stopCloudStorage:e=>t("post",`${r}CSS/C_CSS_StopManualStorage`,e),startSGSnapshot:e=>t("get",`${r}SG/C_SG_StartSnapshot`,e),startSGStorage:e=>(e.IVIdx=e.idx||"0",t("get",`${r}SG/VODFile.flv`,e)),startTalk:e=>t("get",`${r}audio/startTalk2`,e),startCall:e=>t("get",`${r}audio/startCall2`,e),stoptStream:e=>t("get",`${r}stopPlay2`,e),enablePlayAudio:e=>t("get",`${r}enablePlayAudio`,e),startLocalSnap:e=>t("get",`${r}localSnapshot2`,e),startLocalSnapShot:e=>t("get",`${r}localSerialSnapshot2`,e),stopLocalSnapShot:e=>t("get",`${r}cancelLocalSerialSnapshot2`,e),startLocalVideo:e=>t("get",`${r}localRecord2`,e),stopLocalVideo:e=>t("get",`${r}CancelLocalRecord2`,e),getCloudFile:e=>t("get",`${r}CSS/C_CSS_QueryStorageFiles`,e),getDeviceFile:e=>t("get",`${r}SG/C_SG_QueryRecordFiles`,e),downloadCloudFile:e=>t("get",`${r}downloadCloudFile2`,e),downloadDeviceFile:e=>t("get",`${r}downloadDeviceFile2`,e),setPuaseDownload:e=>t("get",`${r}puaseDownload2`,e),setRestoreDownload:e=>t("get",`${r}restoreDownload2`,e),setStopDownload:e=>t("get",`${r}stopDownload2`,e),getVodCloudFile:e=>t("get",`${r}vodCloudFile2`,e),getVodDeviceFile:e=>t("get",`${r}vodDeviceFile2`,e),setPuaseVod:e=>t("get",`${r}puaseVod2`,e),setRestoreVod:e=>t("get",`${r}restoreVod2`,e),setSpeedVod:e=>t("get",`${r}setVodSpeed2`,e),setOffsetVod:e=>t("get",`${r}setVodOffset2`,e),subscriptionGps:e=>{let t=e.token,o=e.epid||"",n=e.puid||"",a=e.idx||0;return s("POST",r+"RawRequest?dstType=33&token="+t,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" EPID="'+o+'"><Res Type="ST" Idx="'+a+'" OptID="C_GS_SubscribeGPSData"><Param></Param></Res></C><OSets><Res OType="201" OID="'+n+'" Type="GPS" Idx="'+a+'"></Res></OSets></M>'})},getPuidLastGps:e=>{let t=e.token,o=e.puid||[],n=e.epid||"",a="<OSets>";return a+='<Res OType="201" OID="'+o+'" Type="GPS" Idx="0"></Res>',a+="</OSets>",s("POST",r+'RawRequest?dstType=33&dstID=""&token='+t,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" EPID="'+n+'"><Res Type="ST" Idx="0" OptID="C_GS_QueryLastGPSData"><Param></Param></Res></C>'+a+"</M>"})},getPuidHistoryGps:e=>{let t=e.token,o=e.offset||0,n=e.count||100,a=e.begin,i=e.end,d=e.puid,l=e.epid||"",p="<OSets>";return p+='<Res OType="201" OID="'+d+'" Type="ST" Idx="0"></Res>',p+="</OSets>",s("POST",r+'RawRequest?dstType=33&dstID=""&token='+t,{xml:'<?xml version="1.0" encoding="UTF-8"?><M Type="ComReq"><C Type="C" EPID="'+l+'"><Res Type="ST" Idx="0" OptID="C_GS_QueryHistoryGPSData"><Param  Offset="'+o+'" Count="'+n+'" Begin="'+a+'" End="'+i+'"></Param></Res></C>'+p+"</M>"})}}}));
